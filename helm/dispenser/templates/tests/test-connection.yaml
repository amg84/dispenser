apiVersion: batch/v1
kind: Job
metadata:
  name: "{{ include "dispenser.fullname" . }}-test-connection"
  namespace: {{ .Values.namespace }}
  labels:
    {{- include "dispenser.labels" . | nindent 4 }}
  annotations:
    "helm.sh/hook": test
spec:
  template:
    spec:
      containers:
        - name: dispenser-redis-cli
          image: redis:latest
          command:
            - redis-cli
            - -h
            - {{ include "redis.fullname" . }}
            - -p
            - {{ .Values.service.port }}'
            - PING
      restartPolicy: OnFailure
  backoffLimit: 10
